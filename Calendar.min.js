/**
 * LBS Calendar 
 * Date: 2012-10-25 
 **/
!function(a){"use strict";var b=function(){function a(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=b.left+(self.pageXOffset||e.scrollLeft||d.scrollLeft)-g,i=b.top+(self.pageYOffset||e.scrollTop||d.scrollTop)-f;return{x:h,y:i}}function b(){var a=k.scrollLeft||l.scrollLeft,b=k.scrollTop||l.scrollTop;return"CSS1Compat"!=j.compatMode&&(a=l.scrollLeft,b=l.scrollTop),{x:a,y:b}}function c(a){return a?a:(a=window.event,a.target=a.srcElement,a.pageX=a.clientX+b().x,a.pageY=a.clientY+b().y,a.stopPropagation=function(){a.cancelBubble=!0},a.preventDefault=function(){a.returnValue=!1},a)}function d(a,b,d){a.attachEvent?(a["e"+b+d]=d,a[b+d]=function(){a["e"+b+d].call(a,c())},a.attachEvent("on"+b,a[b+d])):a.addEventListener(b,d,!1)}function e(a){return j.createElement(a)}function f(a){return parseInt(a)<10?"0"+a:a}function g(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")}function h(a,b){g(a,b)||(a.className+=" "+b)}function i(a,b){if(g(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c,"")}}var j=document,k=j.documentElement,l=j.body;return{getScroll:b,getPosition:a,format:f,create:e,on:d,hasClass:g,addClass:h,removeClass:i}}();a.Calendar=function(){this._init.apply(this,arguments)},Calendar.prototype={_init:function(a){a=a||{},this.parent=a.parent||document.getElementsByTagName("body")[0],this.count=a.count||1,this.past=a.past===!1?!1:!0,this.range=a.range||!1,this.hover=a.hover||!1,this.firstInput=a.firstInput,this.year=parseInt(a.year)||(new Date).getFullYear(),this.month=parseInt(a.month)||(new Date).getMonth()+1,this.today=(new Date).getFullYear()+"-"+b.format((new Date).getMonth()+1)+"-"+b.format((new Date).getDate()),this.select=a.select||function(){},this.input=a.input,this.value=0,this.initDate="1900-01-01",this.startDate=this.endDate=this.initDate},_create:function(){return this.box||(this.exist=!0,this.box=b.create("div"),this.box.className="QBZ_calendar",this.prev=b.create("a"),this.prev.className="QBZ_prev",this.prev.href="javascript:;",this.prev.innerHTML="&lt;",this.box.appendChild(this.prev),this.next=b.create("a"),this.next.className="QBZ_next",this.next.href="javascript:;",this.next.innerHTML="&gt;",this.box.appendChild(this.next),this.content=b.create("div"),this.content.className="QBZ_content",this._draw(),this.box.appendChild(this.content),this.parent.appendChild(this.box),this._bind()),this},_draw:function(){for(var a=0;a<this.count;a++)this.month=this.month+(a?1:0),this.month>12&&(this.year++,this.month-=12),this.month<1&&(this.year--,this.month+=12),this.content.appendChild(this._drawMonth(this.year,this.month));return this},_drawWeek:function(){for(var a=document.createDocumentFragment(),c="日一二三四五六".split(""),d=null,e=0,f=c.length;f>e;e++)d=b.create("div"),d.className="QBZ_week",d.innerHTML=c[e],a.appendChild(d);return a},_darwDay:function(a,c){var d=document.createDocumentFragment(),e=new Date(a,c-1,1).getDay(),f=new Date(a,c,0).getDate(),g=[],h=null,i=0,j=0,k=parseInt(this.today.replace(/-/g,"")),l=parseInt(this.initDate.replace(/-/g,"")),m=parseInt(this.startDate.replace(/-/g,"")),n=parseInt(this.endDate.replace(/-/g,"")),o=k;for(j=0;e>j;j++)g.push(0);for(j=1;f>=j;j++)g.push(j);for(j=0;42>j;j++)h=b.create("a"),h.href="javascript:;",i=g.shift(),i?(h.date=a+"-"+b.format(c)+"-"+b.format(i),h.innerHTML=i,h.className="day_date",o=h.date.replace(/-/g,""),o==k&&(h.className+=" day_today"),this.past||k>o&&(h.className="day_disabled"),this.range&&(o==m&&(h.className+=" day_start"),o==n&&(h.className+=" day_end"),n>m&&m!=l&&o>m&&n>o&&(h.className+=" day_range"))):(h.innerHTML="&nbsp;",h.className="day_disabled"),d.appendChild(h);return d},_drawMonth:function(a,c){var d=b.create("dl"),e=b.create("dt"),f=b.create("dd"),g=b.create("div");return d.className="QBZ_dl",e.className="QBZ_dt",f.className="QBZ_dd",g.className="QBZ_time",g.innerHTML=a+"年"+c+"月",e.appendChild(g),e.appendChild(this._drawWeek()),f.appendChild(this._darwDay(a,c)),d.appendChild(e),d.appendChild(f),d},_nextMonth:function(){return this.month++,this.draw(),this},_prevMonth:function(){return this.month-=2*this.count-1,this.draw(),this},_bind:function(){var a=this,c=this.initDate.replace("-",""),d=c;b.on(this.box,"click",function(b){if(b.stopPropagation(),a.status){var c=b.target;"A"===c.tagName.toUpperCase()&&c.className.indexOf("QBZ_prev")>-1&&a._prevMonth(),"A"===c.tagName.toUpperCase()&&c.className.indexOf("QBZ_next")>-1&&a._nextMonth(),"A"===c.tagName.toUpperCase()&&c.className.indexOf("day_date")>-1&&(a.hide(),a.value=c.date,a.select&&a.select(c))}}),b.on(document,"click",function(b){if(a.status){var c=b.target;a.input&&c!==a.input&&a.hide()}}),this.range&&this.hover&&b.on(this.box,"mouseover",function(e){if(e.stopPropagation(),a.status&&!(a.firstInput&&a.input&&a.firstInput==a.input||(d=a.startDate.replace("-",""),d==c))){var f=e.target,g=a.box.getElementsByTagName("a"),h=g.length,i=0,j=-1,k=-1;if("A"===f.tagName.toUpperCase()&&f.className.indexOf("day_date")>-1){if(f.date.replace("-","")<d)return;for(i=0;h>i;i++)b.hasClass(g[i],"day_start")&&(j=i),g[i]==f&&(k=i),b.hasClass(g[i],"day_hover")&&b.removeClass(g[i],"day_hover");for(i=j+1;k>i;i++)b.hasClass(g[i],"day_hover")||b.hasClass(g[i],"day_disabled")||(g[i].className+=" day_hover")}}})},draw:function(){return this.exist?(this.content.innerHTML="",this._draw(),this):this._create()},setPosition:function(a){this.exist||this._create();var a=a||this.input,c=b.getPosition(a).x,d=b.getPosition(a).y;return this.box.style.left=c+"px",this.box.style.top=d+a.offsetHeight+"px",this},setValue:function(a){var a=a||this.input;return a.value=this.value,this},show:function(){return this.status=!0,this.exist||this._create(),this.box.style.display="block",this},hide:function(){return this.status=!1,this.box.style.display="none",this}}}(window);